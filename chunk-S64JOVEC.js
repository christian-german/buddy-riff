import{a as L,b as X,c as H,d as J,h as U,j as T,k as Y}from"./chunk-GOV3QCWE.js";import{$a as v,Ba as a,Eb as q,Fa as E,Fb as M,Gb as O,Ka as b,Oa as p,Va as c,Wa as G,Xa as D,Ya as $,Za as r,_a as o,ab as z,bb as y,ca as W,cb as m,da as S,db as C,ea as k,eb as P,fb as w,gb as l,hb as I,ib as x,j as F,jb as j,ka as N,kb as Q,lb as B,nb as A,pb as K}from"./chunk-5RIKC5GB.js";var ae=["fretboardGrid"],le=()=>[3,5,7,9,12,15,17,19,21],de=()=>[24];function ce(n,g){if(n&1&&(r(0,"div",10),l(1),o()),n&2){let e=g.$implicit;a(),x(" ",e," ")}}function me(n,g){if(n&1&&(r(0,"div"),l(1),o()),n&2){let e=m().$implicit,t=m().$implicit,i=m();$(i.getNoteClass(i.getNoteAtPosition(t,e))),D("playing",i.isPositionInCurrentlyPlayingInversion(t,e)),a(),x(" ",i.getNoteAtPosition(t,e)," ")}}function ge(n,g){if(n&1&&(r(0,"div",13),p(1,me,2,5,"div",14),o()),n&2){let e=g.$implicit,t=m().$implicit,i=m();D("fret-marker",A(5,le).includes(e))("octave-marker",A(6,de).includes(e)),a(),c("ngIf",i.isPositionInTriad(t,e))}}function pe(n,g){if(n&1&&(r(0,"div",11),p(1,ge,2,7,"div",12),o()),n&2){let e=m();a(),c("ngForOf",e.frets)}}var _=function(n){return n.Root="root",n.Third="third",n.Fifth="fifth",n.Other="other",n}(_||{}),V=(()=>{class n{stopPlayback(){this.isPlaying=!1,this.currentlyPlayingInversion=null,this.audioService.stopAll()}constructor(e,t){this.audioService=e,this.cdr=t,this.diagramName="",this.autoPlay=!1,this.isPaused=!1,this.displayedFrets=[],this.playingComplete=new N,this.inversionChange=new N,this.currentInversions=[],this.currentlyPlayingInversion=null,this.totalFrets=22,this.strings=[1,2,3,4,5,6],this.frets=[],this.isPlaying=!1,this.playbackPromise=null}scrollToCurrentInversion(){if(!this.currentlyPlayingInversion||!this.fretboardGrid)return;let e=Number.MAX_SAFE_INTEGER;for(let s of this.currentlyPlayingInversion.positions){let d=s.fret+this.currentlyPlayingInversion.baseFret-1;d<e&&(e=d)}let t=Math.max(0,(e-2)*40),i=this.fretboardGrid.nativeElement.closest(".whole-fretboard");i&&i.scrollTo({left:t,behavior:"smooth"})}ngOnChanges(e){this.initializeFrets(),e.diagramName&&(this.updateDiagram(),this.autoPlay&&this.currentInversions.length>0&&!this.isPaused&&this.audioService.loadInstrument().then(()=>{this.playAllInversions()})),e.isPaused&&!e.isPaused.firstChange&&(this.isPaused?this.isPlaying=!1:this.autoPlay&&this.currentInversions.length>0&&!this.isPlaying&&this.currentlyPlayingInversion&&this.audioService.loadInstrument().then(()=>{this.playAllInversions()})),e.displayedFrets&&this.initializeFrets()}initializeFrets(){this.displayedFrets&&this.displayedFrets.length>0?this.frets=[...this.displayedFrets]:this.frets=Array.from({length:this.totalFrets+1},(e,t)=>t)}playAllInversions(){return F(this,null,function*(){if(!this.currentInversions||this.currentInversions.length===0){console.warn("No inversions to play"),this.playingComplete.emit();return}this.isPlaying=!0;try{let e=0;if(this.currentlyPlayingInversion){let t=this.currentInversions.findIndex(i=>i===this.currentlyPlayingInversion);t!==-1&&(e=t)}for(let t=e;t<this.currentInversions.length&&!(!this.isPlaying||this.isPaused);t++){let i=this.currentInversions[t];if(this.currentlyPlayingInversion=i,this.inversionChange.emit(i),this.cdr.detectChanges(),this.scrollToCurrentInversion(),yield this.playInversion(i),t<this.currentInversions.length-1){if(!this.isPlaying||this.isPaused)break;yield new Promise(s=>setTimeout(s,500))}}this.isPlaying&&!this.isPaused&&(this.currentlyPlayingInversion=null,this.cdr.detectChanges(),this.playingComplete.emit())}catch(e){console.error("Error playing inversions:",e),this.currentlyPlayingInversion=null,this.cdr.detectChanges(),this.playingComplete.emit()}finally{this.isPaused||(this.isPlaying=!1)}})}playInversion(e){return F(this,null,function*(){return this.audioService.playTriadFromPositions(e.positions,e.baseFret,.8,0)})}getNoteAtPosition(e,t){let s=["E","A","D","G","B","E"][6-e],d=t,h=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],f=(h.indexOf(s)+d)%12;return h[f]}getNoteType(e,t){let i=t.endsWith("-triad")?t:`${t}-triad`,s=T[i];if(!s||!s.inversions)return _.Other;let d=t.replace(/-triad$/,""),h=d.endsWith("m"),u=h?d.slice(0,-1):d,f=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],R=f.indexOf(u),Z=h?3:4,ee=7,te=(R+Z)%12,ie=(R+ee)%12,ne=f[te],re=f[ie];return e===u?_.Root:e===ne?_.Third:e===re?_.Fifth:_.Other}getNoteClass(e){return`dot ${this.getNoteType(e,this.diagramName)}`}isPositionInTriad(e,t){let i=this.diagramName.endsWith("-triad")?this.diagramName:`${this.diagramName}-triad`,s=T[i];if(!s||!s.inversions)return!1;for(let d of s.inversions){let h=t;for(let u of d.positions){let f=u.fret+d.baseFret-1;if(u.string===e&&f===h)return!0}}return!1}isPositionInCurrentlyPlayingInversion(e,t){if(!this.currentlyPlayingInversion)return!1;let i=t;for(let s of this.currentlyPlayingInversion.positions){let d=s.fret+this.currentlyPlayingInversion.baseFret-1;if(s.string===e&&d===i)return!0}return!1}updateDiagram(){let e=this.diagramName.endsWith("-triad")?this.diagramName:`${this.diagramName}-triad`,t=T[e];if(!t){console.warn(`Definition not found for: ${e}`);return}this.currentInversions=t.inversions||[]}static{this.\u0275fac=function(t){return new(t||n)(E(Y),E(K))}}static{this.\u0275cmp=b({type:n,selectors:[["app-whole-fretboard-diagram"]],viewQuery:function(t,i){if(t&1&&C(ae,5),t&2){let s;P(s=w())&&(i.fretboardGrid=s.first)}},inputs:{diagramName:"diagramName",autoPlay:"autoPlay",isPaused:"isPaused",displayedFrets:"displayedFrets"},outputs:{playingComplete:"playingComplete",inversionChange:"inversionChange"},features:[W],decls:21,vars:2,consts:[["fretboardGrid",""],[1,"whole-fretboard-diagram-container"],[1,"whole-fretboard"],[1,"string-labels"],[1,"string-label"],[1,"fretboard-content"],[1,"fret-numbers"],["class","fret-number",4,"ngFor","ngForOf"],[1,"fretboard-grid"],["class","string-row",4,"ngFor","ngForOf"],[1,"fret-number"],[1,"string-row"],["class","fret-cell",3,"fret-marker","octave-marker",4,"ngFor","ngForOf"],[1,"fret-cell"],[3,"class","playing",4,"ngIf"]],template:function(t,i){t&1&&(r(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),l(4,"E"),o(),r(5,"div",4),l(6,"B"),o(),r(7,"div",4),l(8,"G"),o(),r(9,"div",4),l(10,"D"),o(),r(11,"div",4),l(12,"A"),o(),r(13,"div",4),l(14,"E"),o()(),r(15,"div",5)(16,"div",6),p(17,ce,2,1,"div",7),o(),r(18,"div",8,0),p(20,pe,2,1,"div",9),o()()()()),t&2&&(a(17),c("ngForOf",i.frets),a(3),c("ngForOf",i.strings))},dependencies:[O,q,M],styles:['.whole-fretboard-diagram-container[_ngcontent-%COMP%]{width:100%;margin:20px 0;font-family:Arial,sans-serif}.whole-fretboard[_ngcontent-%COMP%]{display:flex;flex-direction:row;width:100%;overflow-x:hidden;position:relative}.fret-numbers[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;margin-bottom:5px}.fret-number[_ngcontent-%COMP%]{width:40px;text-align:center;font-size:12px;color:#666}.fretboard-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;border-left:2px solid #333}.string-row[_ngcontent-%COMP%]{display:flex;height:30px;border-bottom:1px solid #999}.string-row[_ngcontent-%COMP%]:first-child{border-top:1px solid #999}.fret-cell[_ngcontent-%COMP%]{width:40px;border-right:1px solid #ccc;display:flex;justify-content:center;align-items:center;position:relative}.fret-cell[_ngcontent-%COMP%]:first-child{border-right:2px solid #333}.fret-marker[_ngcontent-%COMP%]{background-color:#f5f5f5}.octave-marker[_ngcontent-%COMP%]{background-color:#e0e0e0}.octave-marker[_ngcontent-%COMP%]:after{content:"";position:absolute;width:8px;height:8px;background-color:#999;border-radius:50%;bottom:2px}.fretboard-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex-grow:1}.string-labels[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;margin-right:10px;padding-top:30px}.string-label[_ngcontent-%COMP%]{height:30px;display:flex;align-items:center;justify-content:center;font-size:12px;color:#666;width:20px}.dot[_ngcontent-%COMP%]{width:24px;height:24px;border-radius:50%;display:flex;justify-content:center;align-items:center;font-size:10px;font-weight:700;color:#fff}.dot.root[_ngcontent-%COMP%]{background-color:#e74c3c}.dot.third[_ngcontent-%COMP%]{background-color:#3498db}.dot.fifth[_ngcontent-%COMP%]{background-color:#2ecc71}.dot.other[_ngcontent-%COMP%]{background-color:#95a5a6}.dot.playing[_ngcontent-%COMP%]{width:28px;height:28px;border:2px solid #757575;box-shadow:0 0 10px #ffffffb3;z-index:10;animation:_ngcontent-%COMP%_pulse 1s infinite alternate}@keyframes _ngcontent-%COMP%_pulse{0%{box-shadow:0 0 5px #ffffffb3}to{box-shadow:0 0 15px #ffffffe6}}']})}}return n})();function he(n,g){if(n&1&&(r(0,"div",22),v(1,"div",23),o()),n&2){let e=m(2);a(),G("width",e.progressValue,"%")}}function fe(n,g){if(n&1&&(r(0,"div",24),l(1),o()),n&2){let e=m(2);a(),I(e.currentTriad)}}function ue(n,g){if(n&1&&(r(0,"div",27),l(1),o()),n&2){let e=m(3);a(),I(e.currentInversionType)}}function ve(n,g){if(n&1&&(r(0,"div",25)(1,"div",24),l(2),o(),p(3,ue,2,1,"div",26),o()),n&2){let e=m(2);a(2),I(e.currentTriadName),a(),c("ngIf",e.currentInversionType)}}function ye(n,g){if(n&1){let e=z();r(0,"div",28)(1,"app-whole-fretboard-diagram",29,0),y("playingComplete",function(){S(e);let i=m(2);return k(i.onTriadPlayingComplete())})("inversionChange",function(i){S(e);let s=m(2);return k(s.onInversionChange(i))}),o()()}if(n&2){let e=m(2);a(),c("autoPlay",!0)("isPaused",e.isPaused)("diagramName",e.currentTriad)}}function Te(n,g){if(n&1&&(r(0,"div",17),p(1,he,2,2,"div",18)(2,fe,2,1,"div",19)(3,ve,4,2,"div",20)(4,ye,3,3,"div",21),o()),n&2){let e=m();a(),c("ngIf",!e.showSolution),a(),c("ngIf",!e.showSolution),a(),c("ngIf",e.showSolution),a(),c("ngIf",e.showSolution)}}var Ae=(()=>{class n{constructor(){this.isTraining=!1,this.isPaused=!1,this.currentTriad="",this.currentTriadName="",this.currentInversionType=null,this.showSolution=!1,this.progressValue=0,this.delayTime=3,this.waitingForTriadPlayback=!1,this.pausedTimeRemaining=0,this.pauseStartTime=0,this.triads=["D","D#"]}startTraining(){this.isTraining=!0,this.isPaused=!1,this.showNextTriad()}onTriadPlayingComplete(){if(!this.waitingForTriadPlayback)return;this.waitingForTriadPlayback=!1;let e=5*1e3;this.timer=setTimeout(()=>{this.showNextTriad()},e)}onInversionChange(e){e&&e.inversionType?this.currentInversionType=e.inversionType:this.currentInversionType=null}pauseTraining(){if(!(!this.isTraining||this.isPaused)){if(this.isPaused=!0,this.pauseStartTime=Date.now(),this.timer&&clearTimeout(this.timer),this.solutionTimer){if(!this.showSolution){let e=this.progressValue/100*(this.delayTime*1e3);this.pausedTimeRemaining=this.delayTime*1e3-e}clearTimeout(this.solutionTimer)}this.progressTimer&&clearInterval(this.progressTimer)}}resumeTraining(){if(!(!this.isTraining||!this.isPaused))if(this.isPaused=!1,!this.showSolution&&this.pausedTimeRemaining>0){this.solutionTimer=setTimeout(()=>{this.showSolution=!0,this.waitingForTriadPlayback=!0},this.pausedTimeRemaining);let e=Date.now()-this.progressValue/100*(this.delayTime*1e3);this.setupProgressTimer(e,this.delayTime*1e3)}else this.showSolution&&this.waitingForTriadPlayback||this.showSolution&&!this.waitingForTriadPlayback&&(this.timer=setTimeout(()=>{this.showNextTriad()},5e3))}stopTraining(){this.showSolution&&this.fretboardDiagram&&this.fretboardDiagram.stopPlayback(),this.isTraining=!1,this.isPaused=!1,this.currentTriad="",this.currentTriadName="",this.currentInversionType=null,this.showSolution=!1,this.progressValue=0,this.waitingForTriadPlayback=!1,this.pausedTimeRemaining=0,this.timer&&clearTimeout(this.timer),this.solutionTimer&&clearTimeout(this.solutionTimer),this.progressTimer&&clearInterval(this.progressTimer)}setupProgressTimer(e,t){this.progressTimer&&clearInterval(this.progressTimer),this.progressTimer=setInterval(()=>{let i=Date.now()-e;this.progressValue=Math.min(i/t*100,100),this.progressValue>=100&&clearInterval(this.progressTimer)},100)}showNextTriad(){this.solutionTimer&&clearTimeout(this.solutionTimer),this.progressTimer&&clearInterval(this.progressTimer),this.timer&&clearTimeout(this.timer),this.waitingForTriadPlayback=!1,this.showSolution=!1,this.progressValue=0,this.currentTriad=this.getRandomTriad(),this.currentInversionType=null;let e=this.currentTriad.endsWith("-triad")?this.currentTriad:`${this.currentTriad}-triad`,t=T[e];t?this.currentTriadName=t.name:this.currentTriadName=this.currentTriad;let i=this.delayTime*1e3;this.solutionTimer=setTimeout(()=>{this.showSolution=!0,this.waitingForTriadPlayback=!0},i);let s=Date.now();this.setupProgressTimer(s,i)}getRandomTriad(){let e=Math.floor(Math.random()*this.triads.length);return this.triads[e]}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=b({type:n,selectors:[["app-triads-trainer-2"]],viewQuery:function(t,i){if(t&1&&C(V,5),t&2){let s;P(s=w())&&(i.fretboardDiagram=s.first)}},decls:34,vars:7,consts:[["fretboardDiagram",""],[1,"trainer-container"],[1,"controls"],[1,"control-button","start",3,"click","disabled"],[1,"control-button","pause",3,"click","disabled"],[1,"control-button","resume",3,"click","disabled"],[1,"control-button","stop",3,"click","disabled"],[1,"note-legend"],[1,"legend-item"],[1,"legend-color","root"],[1,"legend-color","third"],[1,"legend-color","fifth"],[1,"legend-color","other"],[1,"time-control"],["for","delaySlider"],["id","delaySlider","max","20","min","1","step","1","type","range",3,"ngModelChange","ngModel"],["class","triad-display",4,"ngIf"],[1,"triad-display"],["class","progress-bar-container",4,"ngIf"],["class","triad-name",4,"ngIf"],["class","triad-info",4,"ngIf"],["class","triad-diagram",4,"ngIf"],[1,"progress-bar-container"],[1,"progress-bar"],[1,"triad-name"],[1,"triad-info"],["class","inversion-type",4,"ngIf"],[1,"inversion-type"],[1,"triad-diagram"],[3,"playingComplete","inversionChange","autoPlay","isPaused","diagramName"]],template:function(t,i){t&1&&(r(0,"div",1)(1,"h2"),l(2,"Triads Trainer"),o(),r(3,"div",2)(4,"button",3),y("click",function(){return i.startTraining()}),l(5,"Start"),o(),r(6,"button",4),y("click",function(){return i.pauseTraining()}),l(7,"Pause"),o(),r(8,"button",5),y("click",function(){return i.resumeTraining()}),l(9,"Resume"),o(),r(10,"button",6),y("click",function(){return i.stopTraining()}),l(11,"Stop"),o()(),r(12,"div",7)(13,"div",8),v(14,"div",9),r(15,"span"),l(16,"Root Note"),o()(),r(17,"div",8),v(18,"div",10),r(19,"span"),l(20,"Third"),o()(),r(21,"div",8),v(22,"div",11),r(23,"span"),l(24,"Fifth"),o()(),r(25,"div",8),v(26,"div",12),r(27,"span"),l(28,"Other Notes"),o()()(),r(29,"div",13)(30,"label",14),l(31),o(),r(32,"input",15),B("ngModelChange",function(d){return Q(i.delayTime,d)||(i.delayTime=d),d}),o()(),p(33,Te,5,4,"div",16),o()),t&2&&(a(4),c("disabled",i.isTraining),a(2),c("disabled",!i.isTraining||i.isPaused),a(2),c("disabled",!i.isTraining||!i.isPaused),a(2),c("disabled",!i.isTraining),a(21),x("Delay time: ",i.delayTime," seconds"),a(),j("ngModel",i.delayTime),a(),c("ngIf",i.isTraining))},dependencies:[O,M,U,L,J,X,H,V],styles:[".trainer-container[_ngcontent-%COMP%]{max-width:800px;margin:0 auto;padding:20px;font-family:Arial,sans-serif}h2[_ngcontent-%COMP%]{text-align:center;margin-bottom:20px}.controls[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:10px;margin-bottom:20px}.control-button[_ngcontent-%COMP%]{padding:10px 20px;border:none;border-radius:4px;cursor:pointer;font-weight:700;transition:background-color .3s}.control-button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.start[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff}.pause[_ngcontent-%COMP%]{background-color:#ffc107;color:#000}.resume[_ngcontent-%COMP%]{background-color:#2196f3;color:#fff}.stop[_ngcontent-%COMP%]{background-color:#f44336;color:#fff}.note-legend[_ngcontent-%COMP%]{margin:20px 0;padding:10px;background-color:#f5f5f5;border-radius:4px}.note-legend[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin-top:0;margin-bottom:10px}.legend-item[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:5px}.legend-color[_ngcontent-%COMP%]{width:20px;height:20px;border-radius:50%;margin-right:10px}.root[_ngcontent-%COMP%]{background-color:#e74c3c}.third[_ngcontent-%COMP%]{background-color:#3498db}.fifth[_ngcontent-%COMP%]{background-color:#2ecc71}.other[_ngcontent-%COMP%]{background-color:#95a5a6}.time-control[_ngcontent-%COMP%]{margin:20px 0;display:flex;flex-direction:column;align-items:center}.time-control[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-bottom:10px}.time-control[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:80%;max-width:400px}.triad-display[_ngcontent-%COMP%]{margin-top:30px}.progress-bar-container[_ngcontent-%COMP%]{height:10px;background-color:#f5f5f5;border-radius:5px;overflow:hidden;margin-bottom:20px}.progress-bar[_ngcontent-%COMP%]{height:100%;background-color:#4caf50;transition:width .1s linear}.triad-info[_ngcontent-%COMP%]{text-align:center;margin-bottom:20px}.triad-name[_ngcontent-%COMP%]{font-size:24px;font-weight:700;text-align:center;margin-bottom:5px}.inversion-type[_ngcontent-%COMP%]{font-size:18px;color:#666;text-align:center;margin-bottom:15px}.triad-diagram[_ngcontent-%COMP%]{margin-top:20px}"]})}}return n})();export{Ae as TriadsTrainer2Component};
