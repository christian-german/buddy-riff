import{a as L,b as H,c as J,d as U,h as X,j as w,k as Y}from"./chunk-LXDBUYDL.js";import{$a as y,Ba as l,Eb as q,Fa as M,Fb as P,Gb as C,Ka as _,Oa as g,Va as c,Wa as R,Xa as O,Ya as V,Za as r,_a as o,ab as W,bb as v,ca as N,cb as m,da as E,db as $,ea as D,eb as j,fb as z,gb as s,hb as b,ib as x,j as I,jb as G,ka as A,kb as B,lb as Q,nb as F,pb as K}from"./chunk-5RIKC5GB.js";var at=()=>[3,5,7,9,12,15,17,19,21],lt=()=>[24];function dt(n,p){if(n&1&&(r(0,"div",9),s(1),o()),n&2){let t=p.$implicit;l(),x(" ",t," ")}}function ct(n,p){if(n&1&&(r(0,"div"),s(1),o()),n&2){let t=m().$implicit,e=m().$implicit,i=m();V(i.getNoteClass(i.getNoteAtPosition(e,t))),O("playing",i.isPositionInCurrentlyPlayingInversion(e,t)),l(),x(" ",i.getNoteAtPosition(e,t)," ")}}function mt(n,p){if(n&1&&(r(0,"div",12),g(1,ct,2,5,"div",13),o()),n&2){let t=p.$implicit,e=m().$implicit,i=m();O("fret-marker",F(5,at).includes(t))("octave-marker",F(6,lt).includes(t)),l(),c("ngIf",i.isPositionInTriad(e,t))}}function gt(n,p){if(n&1&&(r(0,"div",10),g(1,mt,2,7,"div",11),o()),n&2){let t=m();l(),c("ngForOf",t.frets)}}var T=function(n){return n.Root="root",n.Third="third",n.Fifth="fifth",n.Other="other",n}(T||{}),S=(()=>{class n{stopPlayback(){this.isPlaying=!1,this.currentlyPlayingInversion=null,this.audioService.stopAll()}constructor(t,e){this.audioService=t,this.cdr=e,this.diagramName="",this.autoPlay=!1,this.isPaused=!1,this.displayedFrets=[],this.playingComplete=new A,this.currentInversions=[],this.currentlyPlayingInversion=null,this.totalFrets=22,this.strings=[1,2,3,4,5,6],this.frets=[],this.isPlaying=!1,this.playbackPromise=null}ngOnChanges(t){this.initializeFrets(),t.diagramName&&(this.updateDiagram(),this.autoPlay&&this.currentInversions.length>0&&!this.isPaused&&this.audioService.loadInstrument().then(()=>{this.playAllInversions()})),t.isPaused&&!t.isPaused.firstChange&&(this.isPaused?this.isPlaying=!1:this.autoPlay&&this.currentInversions.length>0&&!this.isPlaying&&this.currentlyPlayingInversion&&this.audioService.loadInstrument().then(()=>{this.playAllInversions()})),t.displayedFrets&&this.initializeFrets()}initializeFrets(){this.displayedFrets&&this.displayedFrets.length>0?this.frets=[...this.displayedFrets]:this.frets=Array.from({length:this.totalFrets+1},(t,e)=>e)}playAllInversions(){return I(this,null,function*(){if(!this.currentInversions||this.currentInversions.length===0){console.warn("No inversions to play"),this.playingComplete.emit();return}this.isPlaying=!0;try{let t=0;if(this.currentlyPlayingInversion){let e=this.currentInversions.findIndex(i=>i===this.currentlyPlayingInversion);e!==-1&&(t=e)}for(let e=t;e<this.currentInversions.length&&!(!this.isPlaying||this.isPaused);e++){let i=this.currentInversions[e];if(this.currentlyPlayingInversion=i,this.cdr.detectChanges(),yield this.playInversion(i),e<this.currentInversions.length-1){if(!this.isPlaying||this.isPaused)break;yield new Promise(a=>setTimeout(a,500))}}this.isPlaying&&!this.isPaused&&(this.currentlyPlayingInversion=null,this.cdr.detectChanges(),this.playingComplete.emit())}catch(t){console.error("Error playing inversions:",t),this.currentlyPlayingInversion=null,this.cdr.detectChanges(),this.playingComplete.emit()}finally{this.isPaused||(this.isPlaying=!1)}})}playInversion(t){return I(this,null,function*(){return this.audioService.playTriadFromPositions(t.positions,t.baseFret,.8,0)})}getNoteAtPosition(t,e){let a=["E","A","D","G","B","E"][6-t],d=e,h=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],f=(h.indexOf(a)+d)%12;return h[f]}getNoteType(t,e){let i=e.endsWith("-triad")?e:`${e}-triad`,a=w[i];if(!a||!a.inversions)return T.Other;let d=e.replace(/-triad$/,""),h=d.endsWith("m"),u=h?d.slice(0,-1):d,f=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],k=f.indexOf(u),Z=h?3:4,tt=7,et=(k+Z)%12,it=(k+tt)%12,nt=f[et],rt=f[it];return t===u?T.Root:t===nt?T.Third:t===rt?T.Fifth:T.Other}getNoteClass(t){return`dot ${this.getNoteType(t,this.diagramName)}`}isPositionInTriad(t,e){let i=this.diagramName.endsWith("-triad")?this.diagramName:`${this.diagramName}-triad`,a=w[i];if(!a||!a.inversions)return!1;for(let d of a.inversions){let h=e;for(let u of d.positions){let f=u.fret+d.baseFret-1;if(u.string===t&&f===h)return!0}}return!1}isPositionInCurrentlyPlayingInversion(t,e){if(!this.currentlyPlayingInversion)return!1;let i=e;for(let a of this.currentlyPlayingInversion.positions){let d=a.fret+this.currentlyPlayingInversion.baseFret-1;if(a.string===t&&d===i)return!0}return!1}updateDiagram(){let t=this.diagramName.endsWith("-triad")?this.diagramName:`${this.diagramName}-triad`,e=w[t];if(!e){console.warn(`Definition not found for: ${t}`);return}this.currentInversions=e.inversions||[]}static{this.\u0275fac=function(e){return new(e||n)(M(Y),M(K))}}static{this.\u0275cmp=_({type:n,selectors:[["app-whole-fretboard-diagram"]],inputs:{diagramName:"diagramName",autoPlay:"autoPlay",isPaused:"isPaused",displayedFrets:"displayedFrets"},outputs:{playingComplete:"playingComplete"},features:[N],decls:22,vars:3,consts:[[1,"whole-fretboard-diagram-container"],[1,"whole-fretboard"],[1,"string-labels"],[1,"string-label"],[1,"fretboard-content"],[1,"fret-numbers"],["class","fret-number",4,"ngFor","ngForOf"],[1,"fretboard-grid"],["class","string-row",4,"ngFor","ngForOf"],[1,"fret-number"],[1,"string-row"],["class","fret-cell",3,"fret-marker","octave-marker",4,"ngFor","ngForOf"],[1,"fret-cell"],[3,"class","playing",4,"ngIf"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"h3"),s(2),o(),r(3,"div",1)(4,"div",2)(5,"div",3),s(6,"E"),o(),r(7,"div",3),s(8,"B"),o(),r(9,"div",3),s(10,"G"),o(),r(11,"div",3),s(12,"D"),o(),r(13,"div",3),s(14,"A"),o(),r(15,"div",3),s(16,"E"),o()(),r(17,"div",4)(18,"div",5),g(19,dt,2,1,"div",6),o(),r(20,"div",7),g(21,gt,2,1,"div",8),o()()()()),e&2&&(l(2),b(i.diagramName),l(17),c("ngForOf",i.frets),l(2),c("ngForOf",i.strings))},dependencies:[C,q,P],styles:['.whole-fretboard-diagram-container[_ngcontent-%COMP%]{width:100%;margin:20px 0;font-family:Arial,sans-serif}.whole-fretboard[_ngcontent-%COMP%]{display:flex;flex-direction:row;width:100%}.fret-numbers[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;margin-bottom:5px}.fret-number[_ngcontent-%COMP%]{width:40px;text-align:center;font-size:12px;color:#666}.fretboard-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;border-left:2px solid #333}.string-row[_ngcontent-%COMP%]{display:flex;height:30px;border-bottom:1px solid #999}.string-row[_ngcontent-%COMP%]:first-child{border-top:1px solid #999}.fret-cell[_ngcontent-%COMP%]{width:40px;border-right:1px solid #ccc;display:flex;justify-content:center;align-items:center;position:relative}.fret-cell[_ngcontent-%COMP%]:first-child{border-right:2px solid #333}.fret-marker[_ngcontent-%COMP%]{background-color:#f5f5f5}.octave-marker[_ngcontent-%COMP%]{background-color:#e0e0e0}.octave-marker[_ngcontent-%COMP%]:after{content:"";position:absolute;width:8px;height:8px;background-color:#999;border-radius:50%;bottom:2px}.fretboard-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex-grow:1}.string-labels[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;margin-right:10px;padding-top:30px}.string-label[_ngcontent-%COMP%]{height:30px;display:flex;align-items:center;justify-content:center;font-size:12px;color:#666;width:20px}.dot[_ngcontent-%COMP%]{width:24px;height:24px;border-radius:50%;display:flex;justify-content:center;align-items:center;font-size:10px;font-weight:700;color:#fff}.dot.root[_ngcontent-%COMP%]{background-color:#e74c3c}.dot.third[_ngcontent-%COMP%]{background-color:#3498db}.dot.fifth[_ngcontent-%COMP%]{background-color:#2ecc71}.dot.other[_ngcontent-%COMP%]{background-color:#95a5a6}.dot.playing[_ngcontent-%COMP%]{width:28px;height:28px;border:2px solid #757575;box-shadow:0 0 10px #ffffffb3;z-index:10;animation:_ngcontent-%COMP%_pulse 1s infinite alternate}@keyframes _ngcontent-%COMP%_pulse{0%{box-shadow:0 0 5px #ffffffb3}to{box-shadow:0 0 15px #ffffffe6}}']})}}return n})();function pt(n,p){if(n&1&&(r(0,"div",21),y(1,"div",22),o()),n&2){let t=m(2);l(),R("width",t.progressValue,"%")}}function ht(n,p){if(n&1){let t=W();r(0,"div",23)(1,"app-whole-fretboard-diagram",24,0),v("playingComplete",function(){E(t);let i=m(2);return D(i.onTriadPlayingComplete())}),o()()}if(n&2){let t=m(2);l(),c("autoPlay",!0)("isPaused",t.isPaused)("diagramName",t.currentTriad)}}function ft(n,p){if(n&1&&(r(0,"div",17),g(1,pt,2,2,"div",18),r(2,"div",19),s(3),o(),g(4,ht,3,3,"div",20),o()),n&2){let t=m();l(),c("ngIf",!t.showSolution),l(2),b(t.currentTriad),l(),c("ngIf",t.showSolution)}}var Ft=(()=>{class n{constructor(){this.isTraining=!1,this.isPaused=!1,this.currentTriad="",this.showSolution=!1,this.progressValue=0,this.delayTime=3,this.waitingForTriadPlayback=!1,this.pausedTimeRemaining=0,this.pauseStartTime=0,this.triads=["F"]}startTraining(){this.isTraining=!0,this.isPaused=!1,this.showNextTriad()}onTriadPlayingComplete(){if(!this.waitingForTriadPlayback)return;this.waitingForTriadPlayback=!1;let t=5*1e3;this.timer=setTimeout(()=>{this.showNextTriad()},t)}pauseTraining(){if(!(!this.isTraining||this.isPaused)){if(this.isPaused=!0,this.pauseStartTime=Date.now(),this.timer&&clearTimeout(this.timer),this.solutionTimer){if(!this.showSolution){let t=this.progressValue/100*(this.delayTime*1e3);this.pausedTimeRemaining=this.delayTime*1e3-t}clearTimeout(this.solutionTimer)}this.progressTimer&&clearInterval(this.progressTimer)}}resumeTraining(){if(!(!this.isTraining||!this.isPaused))if(this.isPaused=!1,!this.showSolution&&this.pausedTimeRemaining>0){this.solutionTimer=setTimeout(()=>{this.showSolution=!0,this.waitingForTriadPlayback=!0},this.pausedTimeRemaining);let t=Date.now()-this.progressValue/100*(this.delayTime*1e3);this.setupProgressTimer(t,this.delayTime*1e3)}else this.showSolution&&this.waitingForTriadPlayback||this.showSolution&&!this.waitingForTriadPlayback&&(this.timer=setTimeout(()=>{this.showNextTriad()},5e3))}stopTraining(){this.showSolution&&this.fretboardDiagram&&this.fretboardDiagram.stopPlayback(),this.isTraining=!1,this.isPaused=!1,this.currentTriad="",this.showSolution=!1,this.progressValue=0,this.waitingForTriadPlayback=!1,this.pausedTimeRemaining=0,this.timer&&clearTimeout(this.timer),this.solutionTimer&&clearTimeout(this.solutionTimer),this.progressTimer&&clearInterval(this.progressTimer)}setupProgressTimer(t,e){this.progressTimer&&clearInterval(this.progressTimer),this.progressTimer=setInterval(()=>{let i=Date.now()-t;this.progressValue=Math.min(i/e*100,100),this.progressValue>=100&&clearInterval(this.progressTimer)},100)}showNextTriad(){this.solutionTimer&&clearTimeout(this.solutionTimer),this.progressTimer&&clearInterval(this.progressTimer),this.timer&&clearTimeout(this.timer),this.waitingForTriadPlayback=!1,this.showSolution=!1,this.progressValue=0,this.currentTriad=this.getRandomTriad();let t=this.delayTime*1e3;this.solutionTimer=setTimeout(()=>{this.showSolution=!0,this.waitingForTriadPlayback=!0},t);let e=Date.now();this.setupProgressTimer(e,t)}getRandomTriad(){let t=Math.floor(Math.random()*this.triads.length);return this.triads[t]}static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275cmp=_({type:n,selectors:[["app-triads-trainer-2"]],viewQuery:function(e,i){if(e&1&&$(S,5),e&2){let a;j(a=z())&&(i.fretboardDiagram=a.first)}},decls:36,vars:7,consts:[["fretboardDiagram",""],[1,"trainer-container"],[1,"controls"],[1,"control-button","start",3,"click","disabled"],[1,"control-button","pause",3,"click","disabled"],[1,"control-button","resume",3,"click","disabled"],[1,"control-button","stop",3,"click","disabled"],[1,"note-legend"],[1,"legend-item"],[1,"legend-color","root"],[1,"legend-color","third"],[1,"legend-color","fifth"],[1,"legend-color","other"],[1,"time-control"],["for","delaySlider"],["id","delaySlider","max","20","min","1","step","1","type","range",3,"ngModelChange","ngModel"],["class","triad-display",4,"ngIf"],[1,"triad-display"],["class","progress-bar-container",4,"ngIf"],[1,"triad-name"],["class","triad-diagram",4,"ngIf"],[1,"progress-bar-container"],[1,"progress-bar"],[1,"triad-diagram"],[3,"playingComplete","autoPlay","isPaused","diagramName"]],template:function(e,i){e&1&&(r(0,"div",1)(1,"h2"),s(2,"Triads Trainer"),o(),r(3,"div",2)(4,"button",3),v("click",function(){return i.startTraining()}),s(5,"Start"),o(),r(6,"button",4),v("click",function(){return i.pauseTraining()}),s(7,"Pause"),o(),r(8,"button",5),v("click",function(){return i.resumeTraining()}),s(9,"Resume"),o(),r(10,"button",6),v("click",function(){return i.stopTraining()}),s(11,"Stop"),o()(),r(12,"div",7)(13,"h4"),s(14,"Note Colors"),o(),r(15,"div",8),y(16,"div",9),r(17,"span"),s(18,"Root Note"),o()(),r(19,"div",8),y(20,"div",10),r(21,"span"),s(22,"Third"),o()(),r(23,"div",8),y(24,"div",11),r(25,"span"),s(26,"Fifth"),o()(),r(27,"div",8),y(28,"div",12),r(29,"span"),s(30,"Other Notes"),o()()(),r(31,"div",13)(32,"label",14),s(33),o(),r(34,"input",15),Q("ngModelChange",function(d){return B(i.delayTime,d)||(i.delayTime=d),d}),o()(),g(35,ft,5,3,"div",16),o()),e&2&&(l(4),c("disabled",i.isTraining),l(2),c("disabled",!i.isTraining||i.isPaused),l(2),c("disabled",!i.isTraining||!i.isPaused),l(2),c("disabled",!i.isTraining),l(23),x("Delay time: ",i.delayTime," seconds"),l(),G("ngModel",i.delayTime),l(),c("ngIf",i.isTraining))},dependencies:[C,P,X,L,U,H,J,S],styles:[".trainer-container[_ngcontent-%COMP%]{max-width:800px;margin:0 auto;padding:20px;font-family:Arial,sans-serif}h2[_ngcontent-%COMP%]{text-align:center;margin-bottom:20px}.controls[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:10px;margin-bottom:20px}.control-button[_ngcontent-%COMP%]{padding:10px 20px;border:none;border-radius:4px;cursor:pointer;font-weight:700;transition:background-color .3s}.control-button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.start[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff}.pause[_ngcontent-%COMP%]{background-color:#ffc107;color:#000}.resume[_ngcontent-%COMP%]{background-color:#2196f3;color:#fff}.stop[_ngcontent-%COMP%]{background-color:#f44336;color:#fff}.note-legend[_ngcontent-%COMP%]{margin:20px 0;padding:10px;background-color:#f5f5f5;border-radius:4px}.note-legend[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin-top:0;margin-bottom:10px}.legend-item[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:5px}.legend-color[_ngcontent-%COMP%]{width:20px;height:20px;border-radius:50%;margin-right:10px}.root[_ngcontent-%COMP%]{background-color:#e74c3c}.third[_ngcontent-%COMP%]{background-color:#3498db}.fifth[_ngcontent-%COMP%]{background-color:#2ecc71}.other[_ngcontent-%COMP%]{background-color:#95a5a6}.time-control[_ngcontent-%COMP%]{margin:20px 0;display:flex;flex-direction:column;align-items:center}.time-control[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-bottom:10px}.time-control[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:80%;max-width:400px}.triad-display[_ngcontent-%COMP%]{margin-top:30px}.progress-bar-container[_ngcontent-%COMP%]{height:10px;background-color:#f5f5f5;border-radius:5px;overflow:hidden;margin-bottom:20px}.progress-bar[_ngcontent-%COMP%]{height:100%;background-color:#4caf50;transition:width .1s linear}.triad-name[_ngcontent-%COMP%]{font-size:24px;font-weight:700;text-align:center;margin-bottom:20px}.triad-diagram[_ngcontent-%COMP%]{margin-top:20px}"]})}}return n})();export{Ft as TriadsTrainer2Component};
